<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion Date Widget</title>
    <!-- Importing Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* DEFAULT CONFIGURATION */
            --text-color: #111111;
            --border-color: #111111;
            --page-bg-color: #ffffff;
            --box-bg-color: rgba(255, 255, 255, 0.05);
            
            /* Sizing Multipliers */
            --width-mult: 1;
            --height-mult: 1;
            --text-mult: 1;

            /* Base Dimensions (1:2 Ratio) */
            --base-width: 100px;
            --base-height: 200px;
            
            /* Dynamic Dimensions */
            --box-width: calc(var(--base-width) * var(--width-mult));
            --box-height: calc(var(--base-height) * var(--height-mult));
            
            /* Dynamic Typography */
            --font-size-large: calc(3.5rem * var(--text-mult));
            --font-size-small: calc(0.9rem * var(--text-mult));
            --border-width: calc(3px * var(--text-mult));
            --gap: calc(10px * var(--text-mult));
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--page-bg-color);
            font-family: 'Inter', sans-serif;
            overflow: hidden; 
        }

        .widget-container {
            display: flex;
            gap: var(--gap);
            position: relative;
        }

        .box {
            width: var(--box-width);
            height: var(--box-height);
            border: var(--border-width) solid var(--border-color);
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
            position: relative;
            box-sizing: border-box; 
            background-color: var(--box-bg-color);
            transition: all 0.2s ease;
        }

        /* The Day/Month Number */
        .number-text {
            font-size: var(--font-size-large);
            font-weight: 800;
            line-height: 1;
            /* Elongate the font slightly */
            transform: scaleY(1.15); 
            display: inline-block;
        }

        /* The Day Name (Bottom Right) */
        .day-name {
            position: absolute;
            bottom: calc(8px * var(--text-mult));
            right: calc(8px * var(--text-mult));
            font-size: var(--font-size-small);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transform: scaleY(1.1);
        }

        /* --- Settings UI Styles --- */
        .settings-toggle {
            position: absolute;
            top: calc(8px * var(--text-mult));
            right: calc(8px * var(--text-mult));
            opacity: 0.3;
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            transition: opacity 0.3s ease, background 0.2s;
            z-index: 10;
            transform: scale(var(--text-mult));
            transform-origin: top right;
        }

        .settings-toggle:hover {
            opacity: 1;
            background: #fff;
        }

        .widget-container:hover .settings-toggle {
            opacity: 1;
        }

        .settings-panel {
            position: fixed;
            /* Default (Mobile): Centered */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            
            background: #ffffff;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.25);
            display: none;
            flex-direction: column;
            gap: 12px;
            z-index: 101;
            font-size: 0.85rem;
            color: #333;
            min-width: 280px; /* Slightly wider for checkboxes */
            border: 1px solid #e0e0e0;
        }

        /* Desktop: Anchor to the right side so user can see changes */
        @media (min-width: 768px) {
            .settings-panel {
                top: 20px;
                right: 20px;
                left: auto;
                transform: none;
            }
        }

        .settings-panel.active {
            display: flex;
        }

        .settings-header {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
            font-weight: 700;
            color: #000;
        }

        .control-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .control-label {
            font-weight: 600;
            color: #555;
        }
        
        .input-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-label {
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            color: #666;
            user-select: none;
        }

        input[type="color"] {
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 40px;
            height: 30px;
            cursor: pointer;
            padding: 0;
            background: none;
        }

        input[type="range"] {
            width: 100px;
            cursor: pointer;
        }

        /* Divider for visual separation */
        .divider {
            height: 1px;
            background: #eee;
            margin: 5px 0;
        }

        /* Action Buttons */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: background 0.2s, transform 0.1s;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: #111;
            color: white;
        }
        .btn-primary:hover {
            background: #333;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        .btn-secondary:hover {
            background: #e0e0e0;
        }

    </style>
</head>
<body>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <h3 class="settings-header">Widget Settings</h3>
        
        <!-- Colors -->
        <div class="control-group">
            <span class="control-label">Text Color</span>
            <div class="input-wrapper">
                <input type="color" id="textColorPicker" value="#111111">
            </div>
        </div>
        <div class="control-group">
            <span class="control-label">Border Color</span>
            <div class="input-wrapper">
                <label class="checkbox-label"><input type="checkbox" id="borderTransparent"> Transp.</label>
                <input type="color" id="borderColorPicker" value="#111111">
            </div>
        </div>
        <div class="control-group">
            <span class="control-label">Box Color</span>
            <div class="input-wrapper">
                <label class="checkbox-label"><input type="checkbox" id="boxTransparent"> Transp.</label>
                <input type="color" id="boxBgPicker" value="#ffffff">
            </div>
        </div>
        <div class="control-group">
            <span class="control-label">Page Color</span>
            <div class="input-wrapper">
                <label class="checkbox-label"><input type="checkbox" id="pageTransparent"> Transp.</label>
                <input type="color" id="pageBgPicker" value="#ffffff">
            </div>
        </div>
        
        <div class="divider"></div>

        <!-- Dimensions -->
        <div class="control-group">
            <span class="control-label">Box Width</span>
            <input type="range" id="widthSlider" min="0.5" max="2.5" step="0.1" value="1">
        </div>
        <div class="control-group">
            <span class="control-label">Box Height</span>
            <input type="range" id="heightSlider" min="0.5" max="2.5" step="0.1" value="1">
        </div>
        <div class="control-group">
            <span class="control-label">Text Size</span>
            <input type="range" id="textSlider" min="0.5" max="2.0" step="0.1" value="1">
        </div>

        <div class="btn-group">
            <button class="btn btn-secondary" onclick="copyLink()" id="copyBtn">Copy Link</button>
            <button class="btn btn-primary" onclick="toggleSettings()">Done</button>
        </div>
    </div>

    <div class="widget-container">
        <!-- Left Box: Day of Month (DD) -->
        <div class="box" id="dayBox">
            <span class="day-num number-text" id="dayDisplay">01</span>
        </div>

        <!-- Right Box: Month (MM) + Day of Week -->
        <div class="box" id="monthBox">
            <!-- Settings Toggle Icon -->
            <div class="settings-toggle" onclick="toggleSettings()" title="Settings">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </div>
            
            <span class="month-num number-text" id="monthDisplay">01</span>
            <span class="day-name" id="weekdayDisplay">MON</span>
        </div>
    </div>

    <script>
        // --- 1. Date Logic ---
        function updateDate() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const weekday = daysOfWeek[now.getDay()];

            document.getElementById('dayDisplay').textContent = day;
            document.getElementById('monthDisplay').textContent = month;
            document.getElementById('weekdayDisplay').textContent = weekday;
        }

        // --- 2. Settings & Color Logic ---
        const root = document.documentElement;
        
        // Inputs
        const pickers = {
            text: document.getElementById('textColorPicker'),
            border: document.getElementById('borderColorPicker'),
            box: document.getElementById('boxBgPicker'),
            page: document.getElementById('pageBgPicker'),
            width: document.getElementById('widthSlider'),
            height: document.getElementById('heightSlider'),
            textSize: document.getElementById('textSlider')
        };
        
        const transparentChecks = {
            border: document.getElementById('borderTransparent'),
            box: document.getElementById('boxTransparent'),
            page: document.getElementById('pageTransparent')
        };

        function toggleSettings() {
            document.getElementById('settingsPanel').classList.toggle('active');
        }

        function updateColor(key) {
            let val;
            const isTransparent = transparentChecks[key] && transparentChecks[key].checked;
            
            if (isTransparent) {
                val = 'transparent';
            } else {
                val = pickers[key].value;
            }

            if (key === 'text') root.style.setProperty('--text-color', val);
            if (key === 'border') root.style.setProperty('--border-color', val);
            if (key === 'box') root.style.setProperty('--box-bg-color', val);
            if (key === 'page') root.style.setProperty('--page-bg-color', val);

            saveSettings();
            updateURLState();
        }

        function updateSize(key, value) {
            if (key === 'width') root.style.setProperty('--width-mult', value);
            if (key === 'height') root.style.setProperty('--height-mult', value);
            if (key === 'textSize') root.style.setProperty('--text-mult', value);
            
            saveSettings();
            updateURLState();
        }

        // --- 3. Permanency: URL + LocalStorage ---

        function saveSettings() {
            const settings = {};
            // Save Picker Values
            Object.keys(pickers).forEach(key => {
                settings[key] = pickers[key].value;
            });
            // Save Checkbox States
            Object.keys(transparentChecks).forEach(key => {
                settings[key + 'Transp'] = transparentChecks[key].checked;
            });
            localStorage.setItem('notionWidgetSettings', JSON.stringify(settings));
        }

        function updateURLState() {
            const params = new URLSearchParams();
            
            // Helper to determine what to put in URL
            const getUrlVal = (key) => {
                if (transparentChecks[key] && transparentChecks[key].checked) {
                    return 'transparent';
                }
                return pickers[key].value.replace('#', '');
            };

            params.set('text', pickers.text.value.replace('#', ''));
            params.set('border', getUrlVal('border'));
            params.set('box', getUrlVal('box'));
            params.set('page', getUrlVal('page'));
            
            params.set('w', pickers.width.value);
            params.set('h', pickers.height.value);
            params.set('t', pickers.textSize.value);

            const newUrl = `${window.location.pathname}?${params.toString()}`;
            window.history.replaceState(null, '', newUrl);
        }

        function loadSettings() {
            const params = new URLSearchParams(window.location.search);
            const saved = JSON.parse(localStorage.getItem('notionWidgetSettings')) || {};

            // Helper to get value. 
            // isColor=true implies it might be 'transparent' in URL, or hex.
            const getVal = (paramKey, savedKey, defaultVal, isColor) => {
                // 1. URL
                if (params.has(paramKey)) {
                    let val = params.get(paramKey);
                    if (isColor && val !== 'transparent') val = '#' + val;
                    return val;
                }
                // 2. LocalStorage
                // Note: Saved storage separates checkbox state from color value, so we handle that after.
                // But for simplicity, we return default here and handle overrides below.
                if (saved[savedKey]) return saved[savedKey];
                return defaultVal;
            };

            // Set simple defaults (Pickers & Sliders)
            pickers.text.value = getVal('text', 'text', '#111111', true);
            pickers.border.value = getVal('border', 'border', '#111111', true);
            pickers.box.value = getVal('box', 'box', '#ffffff', true);
            pickers.page.value = getVal('page', 'page', '#ffffff', true);
            
            pickers.width.value = getVal('w', 'width', '1', false);
            pickers.height.value = getVal('h', 'height', '1', false);
            pickers.textSize.value = getVal('t', 'textSize', '1', false);

            // Handle Transparency States
            const applyTransparency = (key, paramKey) => {
                if (!transparentChecks[key]) return;
                
                // If URL says 'transparent', ensure box is checked
                if (params.has(paramKey) && params.get(paramKey) === 'transparent') {
                    transparentChecks[key].checked = true;
                } 
                // Else if URL has hex, ensure uncheded
                else if (params.has(paramKey)) {
                     transparentChecks[key].checked = false;
                }
                // Else fallback to saved storage
                else if (saved[key + 'Transp'] !== undefined) {
                    transparentChecks[key].checked = saved[key + 'Transp'];
                }
            };

            applyTransparency('border', 'border');
            applyTransparency('box', 'box');
            applyTransparency('page', 'page');

            // Apply to CSS
            updateColor('text');
            updateColor('border');
            updateColor('box');
            updateColor('page');
            updateSize('width', pickers.width.value);
            updateSize('height', pickers.height.value);
            updateSize('textSize', pickers.textSize.value);
        }

        function copyLink() {
            const btn = document.getElementById('copyBtn');
            const url = window.location.href;
            
            navigator.clipboard.writeText(url).then(() => {
                const originalText = btn.textContent;
                btn.textContent = "Copied!";
                btn.style.background = "#4CAF50";
                btn.style.color = "white";
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = ""; 
                    btn.style.color = "";
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy', err);
                alert("Could not copy link automatically. Please copy the URL from the browser bar.");
            });
        }

        // Event Listeners
        
        // Color Inputs
        Object.keys(pickers).forEach(key => {
            if(key === 'width' || key === 'height' || key === 'textSize') {
                 pickers[key].addEventListener('input', (e) => updateSize(key, e.target.value));
            } else {
                 pickers[key].addEventListener('input', (e) => {
                     // If user picks a color, uncheck transparent
                     if(transparentChecks[key]) transparentChecks[key].checked = false;
                     updateColor(key);
                 });
            }
        });

        // Checkboxes
        Object.keys(transparentChecks).forEach(key => {
            transparentChecks[key].addEventListener('change', () => updateColor(key));
        });

        // Init
        loadSettings();
        updateDate();
        setInterval(updateDate, 60000);

    </script>
</body>
</html>
